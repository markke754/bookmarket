# 图书商城系统

## 1. 项目介绍

图书商城是一个基于Web的在线图书交易平台，支持多角色用户交互，包括买家、卖家和管理员。系统采用前后端分离架构，提供了流畅的用户体验和完善的功能模块。最近更新增加了管理员发布公告和删除用户的功能。

## 2. 技术栈

### 前端
- **框架**: Vue 3 + Composition API
- **路由**: Vue Router 4
- **状态管理**: Pinia
- **UI组件库**: Element Plus
- **HTTP客户端**: Axios
- **构建工具**: Vite

### 后端
- **运行环境**: Node.js
- **Web框架**: Express
- **数据库**: PostgreSQL
- **身份验证**: JWT (JSON Web Token)
- **密码加密**: bcryptjs
- **文件上传**: multer

## 3. 系统功能

### 3.1 用户管理
- 支持三种用户角色：管理员、卖家和买家
- 用户注册、登录和权限控制
- 管理员可以查看所有用户信息
- 管理员可以删除用户

### 3.2 图书管理
- 卖家可以发布、编辑和删除图书
- 支持图书封面上传
- 图书分类和搜索功能
- 管理员可以管理所有图书

### 3.3 订单系统
- 买家可以将图书加入购物车
- 支持购物车管理和结算
- 订单状态跟踪
- 卖家和管理员可以管理订单

### 3.4 支付系统
- 支持多种支付方式（支付宝和微信）
- 卖家可以设置自己的收款码
- 买家可以选择支付方式进行支付

### 3.5 公告系统
- 管理员可以发布系统公告
- 公告内容包含发布时间和发布人
- 所有用户可在首页查看系统公告

## 4. 角色及权限

### 4.1 管理员
- 用户管理：查看和管理所有用户，可以删除用户
- 图书管理：查看和管理所有图书
- 订单管理：查看所有订单信息
- 创建管理员：可以创建新的管理员账号
- 公告管理：发布和管理系统公告

### 4.2 卖家
- 图书管理：添加、编辑和删除自己的图书
- 订单管理：查看和处理收到的订单
- 支付设置：配置自己的收款方式（支付宝/微信）

### 4.3 买家
- 浏览图书：搜索、分类浏览和查看图书详情
- 购物车：将图书添加到购物车，管理购物车
- 下单购买：结算购物车中的商品并选择支付方式
- 订单查看：查看自己的订单历史和状态

## 5. 系统架构

系统采用前后端分离的架构：
- 前端应用通过API与后端服务通信
- 后端提供RESTful API接口
- 数据持久化存储在PostgreSQL数据库中
- 用户认证通过JWT令牌实现
- 静态资源（如图书封面）通过文件系统存储

## 6. 环境要求

### 6.1 开发环境
- Node.js v14.0.0或更高版本
- npm v6.0.0或更高版本
- PostgreSQL v12.0或更高版本

### 6.2 生产环境
- 任何支持Node.js的服务器
- PostgreSQL数据库服务
- Nginx或其他Web服务器（可选，用于静态资源和反向代理）

## 7. 部署指南

### 7.1 前端部署

1. 克隆代码库并进入项目目录
```bash
git clone <仓库地址>
cd <项目目录>
```

2. 安装依赖
```bash
npm install
```

3. 配置环境变量
创建或编辑`.env`文件：
```
VITE_API_URL=http://后端服务器地址:端口
```

4. 开发环境运行
```bash
npm run dev
```

5. 生产环境构建
```bash
npm run build
```
构建完成后，`dist`目录中的文件可以部署到任何Web服务器。

### 7.2 后端部署

1. 进入server目录
```bash
cd server
```

2. 安装依赖
```bash
npm install
```

3. 配置环境变量
创建或编辑`.env`文件：
```
# 服务器配置
PORT=3000

# 数据库配置
DB_USER=postgres
DB_HOST=localhost
DB_NAME=bookstore
DB_PASSWORD=你的数据库密码
DB_PORT=5432

# JWT配置
JWT_SECRET=你的密钥（建议使用随机生成的强密钥）
```

4. 创建数据库
在PostgreSQL中创建名为`bookstore`的数据库。

5. 启动服务器
开发环境：
```bash
npm run dev
```
生产环境：
```bash
npm start
```

### 7.3 完整应用运行（开发环境）

在项目根目录执行：
```bash
npm run start
```
这将同时启动前端和后端服务。

## 8. 数据库结构

主要数据表：
- `users`: 存储用户信息
- `books`: 存储图书信息
- `orders`: 存储订单信息
- `carts`: 存储购物车信息
- `announcements`: 存储系统公告

## 9. 使用指南

### 9.1 默认账号
系统提供以下测试账号：
- 买家账号：用户名 `b`，密码 `b`
- 卖家账号：用户名 `s`，密码 `s`
- 管理员账号：用户名 `a`，密码 `a`

### 9.2 买家操作流程
1. 浏览和购买图书
   - 登录系统后进入买家中心
   - 可以使用搜索栏搜索图书，或通过分类筛选
   - 点击图书卡片查看详情
   - 点击"加入购物车"将图书添加到购物车

2. 购物车和结算
   - 点击页面右下角的购物车图标打开购物车抽屉
   - 在购物车中可以调整商品数量或删除商品
   - 点击"结算"按钮进入结算页面
   - 选择支付方式（支付宝或微信）
   - 扫描支付二维码完成支付
   - 支付成功后，订单状态将更新

3. 查看订单
   - 点击导航栏的"我的订单"
   - 查看所有订单历史和状态

### 9.3 卖家操作流程
1. 管理图书
   - 登录系统后进入卖家中心
   - 点击"添加图书"按钮添加新图书
   - 填写图书信息，包括标题、作者、价格、库存等
   - 上传图书封面图片
   - 可以编辑或删除已发布的图书

2. 订单管理
   - 点击导航栏的"订单管理"
   - 查看和处理买家提交的订单
   - 可以更新订单状态（如标记为已发货）

3. 支付设置
   - 点击导航栏的"支付设置"
   - 上传支付宝和微信的收款二维码
   - 保存设置后，买家购买时将看到您的收款码

### 9.4 管理员操作
1. 用户管理
   - 点击"用户管理"标签页
   - 可以查看所有注册用户的信息
   - 支持按角色筛选和搜索用户
   - 可以删除用户（不能删除管理员或自己）

2. 图书管理
   - 点击"图书管理"标签页
   - 可以查看所有图书信息
   - 支持按分类筛选和搜索图书

3. 订单管理
   - 点击"订单管理"标签页
   - 可以查看所有订单信息
   - 支持按状态筛选和搜索订单

4. 公告管理
   - 点击"公告管理"标签页
   - 可以发布新的系统公告
   - 可以查看所有历史公告

5. 创建管理员账号
   - 在"管理员注册"标签页
   - 填写新管理员的用户名、密码和邮箱
   - 点击"创建管理员账号"按钮提交

## 10. 注意事项

1. 安全性：
   - 生产环境中请修改默认密码
   - 定期更新JWT密钥
   - 使用HTTPS保护API通信

2. 文件上传：
   - 确保服务器有足够的存储空间
   - 确保uploads目录有正确的文件权限

3. 数据备份：
   - 定期备份PostgreSQL数据库
   - 备份上传的图片文件

4. 浏览器兼容性：
   - 推荐使用Chrome、Firefox、Edge等现代浏览器

## 11. 故障排除

1. 登录失败：
   - 检查用户名和密码
   - 确认JWT密钥配置正确
   - 检查数据库连接

2. 图片无法上传或显示：
   - 检查uploads目录权限
   - 确认服务器路径配置正确
   - 检查图片大小和格式限制

3. API请求错误：
   - 检查API基础URL配置
   - 确认后端服务器正在运行
   - 查看浏览器控制台和服务器日志

4. 数据库连接错误：
   - 确认PostgreSQL服务运行中
   - 检查数据库凭据配置
   - 确认数据库名称正确